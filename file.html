<div>
  <input type='file'/ id='audio'>
  <img alt="" id="img">
</div>
<script>
document.getElementById('audio').onchange = function () {
  var files = this.files;
  var reader = new FileReader();
  reader.readAsArrayBuffer(files[0]);

  reader.onload = () => {
    var data = new Uint8Array(reader.result);
    var header = data.slice(0, 10);
    var size = header[9] & 0x7f
             | ((header[8] & 0x7f) << 7)
             | ((header[7] & 0x7f) << 14)
             | ((header[6] & 0x7f) << 21);

    const mp3ID = getStr(0, 3, header);
    // current TAG version is ID3v2.3
    if (mp3ID === 'ID3' && header[3] === 3) {
      data = data.slice(10);
      //如果有扩展标签头就跨过 10个字节
      if ((header[5] & 0x40) === 0x40)
      {
        size -= 10;
        data = data.slice(10);
      }
      readFrame(data, size);
    }
  }
}

function readFrame (data, size) {
  var frame, frameID, imageData, encode, frameSize= 0, seek = 0;
  while (seek < size) {
    frame = data.subarray(seek, seek + 10);
    encode = data[seek + 10];
    frameID = getStr(0, 4, frame);
    frameSize = frame[4] * 0x10000000 + frame[5] * 0x10000 + frame[6] * 0x100 + frame[7];
    if (frameSize == 0) break;
    seek += 10 + frameSize;
    var tmp = data.subarray(seek - frameSize, seek);
    console.log(frameID + '------' + frameSize + '------' + encode);
    // if (frameID === 'APIC') {
    //   var tmp = data.subarray(seek - frameSize, seek);
    //   let i = 0;
    //   while (true)
    //   {
    //     if (255 === tmp[i] && 216 === tmp[i + 1])
    //     {
    //         break;
    //     }
    //     i++;
    //   }

    //   imageData = tmp.subarray(i, frameSize);
    //   var blob = new Blob([imageData], {type: 'image/jpeg'});

    //   var img = URL.createObjectURL(blob);
    //   document.getElementById('img').src = img;
    // }
    if (frameID !== 'APIC' && frameID !== 'COMM') {
      console.log(getStr(0, tmp.length, tmp, encode));
      console.log(tmp);
    }
  }
}

function getStr (start, len, data, encode) {
  // if (encode != 1 && encode != 0) return;
  let tmp = '';
  if (encode === 1) {
    // delete the encode flag at begin of buffer
    let dataBuffer = data.slice(1);
    data = new Uint16Array(dataBuffer.buffer);
    len = data.length;
  }

  for (let i = start; i < len; i++) {
    tmp += String.fromCharCode(data[i]);
  }

  return tmp;
}

</script>
